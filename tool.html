<!DOCTYPE html>
<html lang="th">
<head>
    <!-- ... (head เหมือนเดิม) ... -->
    <style>
        /* ... (style เหมือนเดิม) ... */
    </style>
</head>
<body>
    <div class="container" id="container">
        <!-- Header and View Switcher -->
        <div class="header-bar">
            <div>
                <h1 id="main-header">กำลังโหลด...</h1>
                <p id="sub-header" style="margin: 5px 0 0; color: #555;"></p>
            </div>
            <div id="view-switcher" style="display: flex; gap: 10px;">
                <a href="index.html" style="text-decoration: none;"><button class="secondary">กลับไปหน้าสารบัญ</button></a>
                <button id="go_to_edit_view_btn" class="success">ไปหน้าแก้ไข/เพิ่มคำแปล</button>
                <button id="go_to_create_view_btn" class="secondary" style="display: none;">กลับไปหน้าสร้างข้อมูล</button>
            </div>
        </div>

        <!-- Create View -->
        <div id="create-view" class="view">
            <!-- ... (โค้ดใน create-view เหมือนเดิม) ... -->
        </div>

        <!-- Edit View -->
        <div id="edit-view" class="view">
             <!-- ... (โค้dใน edit-view เหมือนเดิม) ... -->
        </div>

        <!-- Data Work Area (shared) -->
        <div id="data-work-area" style="display: none;">
            <!-- ... (โค้ดใน data-work-area เหมือนเดิม) ... -->
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, doc, getDocs, writeBatch, serverTimestamp, query, where, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
      
        // --- ใส่ firebaseConfig ของคุณที่นี่ ---
        const firebaseConfig = { /* ... YOUR FIREBASE CONFIG ... */ };
      
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const paliCollection = collection(db, "pali_sentences");
        
        let currentBookName = '', currentBookPart = '', currentPrefix = '';
        let currentMode = 'create';

        document.addEventListener('DOMContentLoaded', () => {
            // (Cache DOM elements เหมือนเดิม)

            function initializeTool() {
                const params = new URLSearchParams(window.location.search);
                currentBookName = decodeURIComponent(params.get('bookName') || '');
                currentBookPart = decodeURIComponent(params.get('bookPart') || '');
                currentPrefix = decodeURIComponent(params.get('prefix') || '');

                if (!currentBookName || !currentPrefix) {
                    document.getElementById('main-header').textContent = 'ข้อผิดพลาด';
                    // === ส่วนที่แก้ไข ===
                    document.getElementById('container').innerHTML = '<h1 style="color: red;">ข้อผิดพลาด</h1><p style="text-align:center; color:red;">ไม่พบคัมภีร์หรือ Prefix ที่เลือกใน URL<br>กรุณากลับไปที่หน้าแรกแล้วเลือกคัมภีร์อีกครั้ง</p><br><a href="index.html"><button>กลับไปหน้าแรก</button></a>';
                    return;
                }
                
                document.getElementById('main-header').textContent = `${currentBookName}`;
                document.getElementById('sub-header').textContent = currentBookPart ? `${currentBookPart} (Prefix: ${currentPrefix})` : `(Prefix: ${currentPrefix})`;
                
                const savedUserName = localStorage.getItem('paliToolUserName');
                if (savedUserName) { document.getElementById('user_name').value = savedUserName; }
                document.getElementById('user_name').addEventListener('input', () => { localStorage.setItem('paliToolUserName', document.getElementById('user_name').value); });
                
                // === ส่วนที่แก้ไข: ลบบรรทัดที่ไม่จำเป็นออก ===
                // ไม่ต้องมี mainContent.classList.remove('hidden-section'); แล้ว
                
                switchView('create'); // เริ่มต้นที่หน้าสร้างข้อมูล
                populateStoryDatalistForSearch();
            }

            // (ฟังก์ชันอื่นๆ ทั้งหมดเหมือนเดิม ไม่ต้องแก้ไข)
            
            initializeTool();
        });
    </script>
</body>
</html>